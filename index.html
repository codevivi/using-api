<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous" />
    <title>Using Dog Api</title>
    <style>
        img {
            object-fit: cover;
            display: block;
        }

        .cap {
            text-transform: capitalize;
        }
    </style>

</head>

<body class="bg-info-subtle">
    <main class="container pt-3">
        <h1 class="text-center fs-3">Using Api</h1>

        <section class="mb-4 ">
            <h2 class=" fs-4 text-center mb-0">Select breed </h2>
            <small class="text-center w-100 d-block mb-4">task 3</small>
            <div class="row">
                <form id="breed-select-form" action="#" class="form  col-12 col-sm-6 bg-secondary-subtle p-4">
                    <div class="form-group mb-3">
                        <label class="form-label">Select breed and get picture:</label>
                        <select class="form-control" id="select" name="breed">
                        </select>
                        <!-- <small id="error-msg" class="text-danger p-1 mt-2 d-block"></small> -->
                    </div>
                    <button type="submit" class="btn ms-auto  btn-primary d-block">Find</button>
                </form>
                <div class="output col-12 col-sm-6">
                    <img id="selected-breed-img" class="output-img d-block w-100" src="" alt="">
                </div>
            </div>
        </section>
        <section class="mb-4">
            <h2 class=" fs-4 text-center mb-0">Find dog picture by breed input</h2>
            <small class="text-center w-100 d-block mb-4">task 1</small>
            <div class="row">
                <form id="breed-input-form" action="#" class="form  col-12 col-sm-6 bg-secondary-subtle p-4">
                    <div class="form-group">
                        <label class="form-label" for="breed">Find dog picture by breed:</label>
                        <input id="breed" required minlength="2" maxlength="50" placeholder="Enter dog breed" name="breed" value="" class="form-control" type="text">
                        <small id="error-msg" class="text-danger p-1 mt-2 d-block"></small>
                    </div>
                    <button type="submit" class="btn ms-auto  btn-primary d-block">Find</button>
                </form>
                <div class="output col-12 col-sm-6">
                    <img id="breed-img" class="output-img d-block w-100" src="" alt="">
                </div>

            </div>
        </section>
        <section class="mb-4 ">
            <h2 class=" fs-4 text-center mb-0">Your breed picture gallery</h2>
            <small class="text-center w-100 d-block mb-4">task 2</small>
            <div id="gallery" class="d-flex flex-wrap mx-auto justify-content-center align-items-stretch">

            </div>

        </section>
    </main>
    <script>
        const breedSelectForm = document.getElementById('breed-select-form');
        const selectEl = document.getElementById('select');
        const breedInputForm = document.getElementById('breed-input-form');
        const breedInput = document.getElementById('breed');
        const errorEl = document.getElementById('error-msg');
        const breedImgEl = document.getElementById('breed-img');
        const selectedBreedImgEl = document.getElementById('selected-breed-img');
        const gallery = document.getElementById('gallery');

        breedInputForm.addEventListener('submit', (e) => { getPictureByBreed(e, breedImgEl, true) });
        breedSelectForm.addEventListener('submit', (e) => { getPictureByBreed(e, selectedBreedImgEl) });

        fetch('https://dog.ceo/api/breeds/list/all').then((res) => {
            return res.json()
        }).then((data) => {
            if (data.status === 'success') {
                for (prop in data.message) {
                    let breed = prop;
                    let subbreedArr = data.message[breed];
                    console.log(breed, subbreedArr);
                    breed = capitalizeWord(breed);
                    selectEl.innerHTML += `<option value=${breed}>${breed}</option>`
                    subbreedArr.forEach((subBreed) => {
                        subBreed = capitalizeWord(subBreed);
                        breedAndSub = `${breed} ${subBreed}`;
                        selectEl.innerHTML += `<option value=${breedAndSub}>${breedAndSub}</option>`
                    })
                }
            }
        }).catch((e) => { console.log(e) });

        function getPictureByBreed(e, outputImgEl, all = false) {
            //also finds if subbreed provided (2 words);
            e.preventDefault();
            if (all) {
                gallery.innerHTML = '';
            }
            outputImgEl.src = '';
            outputImgEl.alt = '';
            errorEl.textContent = '';

            console.log(e.target);
            console.log(getFormData(e.target));
            let breed = getFormData(e.target).breed.trim().toLowerCase().replace(' ', '/');
            if (!breed) {
                errorEl.textContent = 'Search field is empty';
                e.target.reset();
                return;
            }
            fetch(`https://dog.ceo/api/breed/${breed}/images/random`).then((res) => {
                if (res.statusText === 'Not Found') {
                    let msg = "Nuotrauka nerasta";
                    errorEl.textContent = msg;
                    e.target.reset();
                    throw new Error(msg);
                }
                return res.json();
            }).then((data) => {
                outputImgEl.src = data.message;
                outputImgEl.alt = 'Dog ' + breed + ' picture';

                if (all) {
                    fetch(`https://dog.ceo/api/breed/${breed}/images`).then((res) => {
                        return res.json();
                    }).then((data) => {
                        if (data.status === 'success') {
                            data.message.forEach((url, ind) => {
                                gallery.innerHTML += `<img class="w-25 m-2" src=${url} alt='dog ${breed} picture ${ind}' />`;
                            })
                        }
                    }).catch((e) => {
                        console.log(e);
                    })
                }
            }).catch((e) => { console.log(e) })
        }
        function capitalizeWord(word) {
            word = word.toLowerCase().charAt(0).toUpperCase() + word.slice(1);
            return word;
        }
        function getFormData(form) {
            const formData = new FormData(form);
            let data = {};
            for (const [key, value] of formData) {
                data[key] = value;
            }
            return data;
        }

    </script>
</body>

</html>